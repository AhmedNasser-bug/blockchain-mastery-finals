---
interface Props {
  id?: string;
}
const { id = "hintPopup" } = Astro.props;
---

<div id={id} class="hint-overlay hidden">
  <div class="hint-card">
    <div class="hint-header">
      <span class="hint-icon">ðŸ’¡</span>
      <h3>HINT</h3>
      <button class="hint-close" id={`${id}-close`}>&times;</button>
    </div>
    <div class="hint-body">
      <p id={`${id}-text`} class="hint-text">This is a hint.</p>
    </div>
  </div>
</div>

<style>
  .hint-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; /* Allow clicks through until active? No, usually modal or toast. Let's make it a toast at the top center or bottom. */
    /* Let's go with a Modal-like overlay but non-blocking if possible? 
       User said "floats above the screen". 
       Let's use a centered position but allow closing. */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 1;
    transition: opacity 0.3s ease;
    background: rgba(0,0,0,0.5); /* Dim background for focus */
    pointer-events: auto;
  }

  .hint-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .hint-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-top: 4px solid var(--accent-yellow); /* Yellow for Hint */
    padding: 20px;
    border-radius: 16px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    transform: translateY(0);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .hint-overlay.hidden .hint-card {
    transform: translateY(20px) scale(0.95);
  }

  .hint-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .hint-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: var(--accent-yellow);
    letter-spacing: 1px;
    flex-grow: 1;
    margin-left: 10px;
  }

  .hint-icon {
    font-size: 1.5rem;
  }

  .hint-close {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0 5px;
    line-height: 1;
  }
  .hint-close:hover { color: var(--text-primary); }

  .hint-text {
    font-size: 1.1rem;
    line-height: 1.6;
    color: var(--text-secondary);
    white-space: pre-wrap; /* Preserve formatting */
  }
</style>

<script>
  class HintPopup {
      private container: HTMLElement;
      private textEl: HTMLElement;

      constructor(container: HTMLElement) {
          this.container = container;
          this.textEl = container.querySelector('.hint-text')!;
          
          this.initListeners();
      }

      private initListeners() {
          // Listen for hint requests from Footer or Global
          window.addEventListener('request-hint', (e: any) => {
               // Expecting e.detail.hint
               if(e.detail && e.detail.hint) {
                   this.show(e.detail.hint);
               }
          });
          
          // Close button logic
          const closeBtn = document.getElementById(`${this.container.id}-close`);
          if(closeBtn) {
              closeBtn.addEventListener('click', () => this.hide());
          }

          // Escape key
          document.addEventListener('keydown', (e) => {
              if(e.key === 'Escape') this.hide();
          });
      }

      public show(text: string) {
          this.textEl.textContent = text;
          this.container.classList.remove('hidden');
      }

      public hide() {
          this.container.classList.add('hidden');
      }
  }

  // Init
  document.querySelectorAll('.hint-overlay').forEach(el => new HintPopup(el as HTMLElement));
</script>
